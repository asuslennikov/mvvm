def releaseProperties = new Properties()
file("release.properties").withInputStream { releaseProperties.load(it) }
def versionMajor = releaseProperties.getProperty("release.version.major").toInteger()
def versionMinor = releaseProperties.getProperty("release.version.minor").toInteger()
def versionPatch = releaseProperties.getProperty("release.version.patch").toInteger()
def version = "${versionMajor}.${versionMinor}.${versionPatch}"
def versionTag = "v${version}"

def isAndroidProject(def propject) {
    def hasAndroidPlugin = false
    propject.plugins.each { plugin ->
        hasAndroidPlugin = hasAndroidPlugin || plugin.class.canonicalName.contains("com.android")
    }
    return hasAndroidPlugin
}

gradle.projectsEvaluated {
    rootProject.subprojects { childProject ->
        task sourcesJar(type: Jar) {
            if (!isAndroidProject(childProject)) {
                from sourceSets.main.allJava
            } else {
                from android.sourceSets.main.java.sourceFiles
            }
            archiveClassifier = 'sources'
        }

        artifacts {
            archives sourcesJar
        }
    }
}